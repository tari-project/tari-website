<!DOCTYPE html>
<html class="no-js">
  <head>

    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Tari Protocol Discussion 20</title>

<meta property="og:description" content="Tari is a new open source, decentralized protocol that reimagines the future of digital assets." />
<meta property="og:site_name" content="Tari" />
<meta property="og:title" content="Tari Protocol Discussion 20" />
<meta property="og:url" content="http://localhost:4000/2019/02/04/tari-protocol-discussion-20.html" />
<meta property="og:image" content="http://localhost:4000/tari-splash.png" />
<meta property="og:image:secure_url" content="http://localhost:4000/tari-splash.png" />
<meta property="og:type" content="website" />
  
<meta name="description" content="Tari is a new open source, decentralized protocol that reimagines the future of digital assets." />
<meta itemprop="name" content="Tari"/>
<meta itemprop="title" content="Tari Protocol Discussion 20" />
<meta itemprop="url" content="http://localhost:4000/2019/02/04/tari-protocol-discussion-20.html"/>
<meta itemprop="thumbnailUrl" content="http://localhost:4000/tari-splash.png"/>
<meta itemprop="image" content="http://localhost:4000/tari-splash.png" />
<link rel="image_src" href="http://localhost:4000/tari-splash.png" />
  
<meta name="twitter:site" content="Tari">
<meta name="twitter:title" content="Tari Protocol Discussion 20"/>
<meta name="twitter:url" content="http://localhost:4000/2019/02/04/tari-protocol-discussion-20.html"/>
<meta name="twitter:image" content="http://localhost:4000/tari-splash.png"/>
<meta name="twitter:card" content="summary"/>

<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<!-- CSS -->
<link rel="stylesheet" href="/css/owl.carousel.css" />
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/avenir-std.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/airspace.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/ionicons.min.css" />
<link rel="stylesheet" href="/css/animate.css" />
<link rel="stylesheet" href="/css/responsive.css" />
<link rel="stylesheet" href="/css/syntax.css" />

<!-- Js -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/min/rellax.min.js"></script>
<script src="/js/min/waypoints.min.js"></script>
<script src="/js/jquery.counterup.js"></script>

<script src="/js/main.js"></script>

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b04a80b744e1cff"></script>



<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-115476091-1', 'auto');
    ga('send', 'pageview');
</script>


  </head>
  <body class="page-">


    <!-- Header Start -->
<header>
<div class="container">
  <div class="row">
    <!-- header Nav Start -->
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header col-md-4">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
            <span class="visible-xs-inline visible-sm-inline"><svg class="logo--gem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71.1"><path d="M29.1 0L0 18.9v19.8L28.9 71 70 38.8V18.9L29.1 0zM29.7 8L63 23.4V32L12.7 19 29.7 8zM32.5 31.4l26.8 6.9L32.5 59.3V31.4zM7 24.8l18.5 4.7v27.1L7 36V24.8z"/></svg></span>
            <svg class="logo--wordmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 53.3 18"><path d="M21.1 0L15 18h3.9l1.3-4.2h5.3l1.3 4.2h3.9L24.6 0H21.1zM21.2 10.5l1.6-5.4 1.6 5.4H21.2z"/><rect x="49.6" width="3.6" height="18"/><path d="m40 11.1c3.3-0.2 5.2-2.2 5.2-5.5 0-3.5-2.1-5.5-5.7-5.5h-6.8v18h3.6v-5.6l5 5.6h4.7l-6.2-6.9 0.2-0.1zm-3.6-3.4v-4.3h3.1c1.4 0 2.1 0.8 2.1 2.2s-0.7 2.2-2.1 2.2h-3.1z"/><polygon points="6.1 18 9.7 18 9.7 3.4 15.8 3.4 15.8 0 0 0 0 3.4 6.1 3.4"/></svg>

          </a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse col-md-8" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
              <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Documentation
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                      <ul>
                          <li><a class="dropdown-item" href="#">Installation guide</a></li>
                          <li> <a class="dropdown-item" href="https://rfc.tari.com/" target="_blank">Tari RFC</a></li>
                      </ul>


                  </div>
              </li>
            <li><a href="https://www.github.com/tari-project" target="_blank">Source code </a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/faq">FAQ</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
  </div>
</div>
</header><!-- header close -->



    <div class="post">

  <div class="container">
  <div class="row">
    <div class="col-md-8">

      <div class="post-img" style="background-image:url(/img/posts/protocol-discussion-20.png)">
          <img src="/img/posts/placeholder-spacer.gif" />
      </div>

      <div class="post-head">
        <h1>Tari Protocol Discussion 20</h1>
        <div class="row">
          <div class="col-sm-6">
            <div class="post-meta">
              <strong class="post-author">Tari Team</strong>
              <p class="post-date">February 04, 2019</p>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="addthis_inline_share_toolbox"></div>
          </div>
        </div>
      </div>

      <!-- Wrapper Start -->
      <section id="post">
        <div class="block">
          
          <p>On Monday, the Tari community discussed how pruned and archival nodes might sync with each other and handle re-orgs. Below is the TL;DR on Monday’s conversation (full transcript included below):</p>

<p>Archival nodes:</p>

<ul>
  <li>Necessary as a safety backstop</li>
  <li>At least one honest archival node required to recover from a deep re-org (a deep re-org is one that goes further back than a node’s pruning horizon)</li>
</ul>

<p>Pruned nodes:</p>

<ul>
  <li>Maintain a subset of all past blocks</li>
  <li>How many blocks should pruned nodes track before pruning (pruning horizon)?</li>
</ul>

<p>Join us for our next discussion on Freenode in #tari-dev.</p>

<p>Discussion times proposed by the Tari community:</p>

<p><strong>Mondays: 6pm CAT (11am EST)</strong></p>

<p><strong>Thursdays: 11am CAT (4am EST)</strong></p>

<p>To keep up with the latest Tari developments, you can follow the project on <a href="https://twitter.com/tari">Twitter</a>.</p>

<h3 id="transcript-of-mondays-discussion">Transcript of Monday’s discussion</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10:58 AM &lt;@cjs77&gt; We'll be answering your questions -- particularly around how nodes can sync / seed /  handle re-orgs in pruned mode &amp; archival node
10:58 AM &lt;@cjs77&gt; But any other Qs are ok too :)
11:02 AM &lt;Blackwolfsa&gt; Thanks, that's probably the biggest negative point with typora, no built in spell checker
11:04 AM &lt;@cjs77&gt; IntelliJ's Markdown navigator plugin does a great job -- maybe check that out
11:05 AM &lt;@cjs77&gt; Instead of repeating everything here, I think the RFC PR https://github.com/tari-project/tari/pull/102 covers all the bases ..
11:05 AM &lt;@cjs77&gt; Thanks blackwolfsa for writing it up;
11:06 AM &lt;@cjs77&gt; If there are any comments about it, feel free to brig it up.
11:07 AM &lt;@cjs77&gt; One thing that one might pick up is that a big re-org happens past the point of the `PruningHorizon`, pruning nodes are stuffed.
11:08 AM &lt;Blackwolfsa&gt; Yes please
11:08 AM &lt;@cjs77&gt; So it highlights why some archival nodes are necessary as a safety backstop
11:08 AM &lt;Blackwolfsa&gt; Yes you have two choices there, find an archive node or a node with a higher pruning horizon
11:08 AM &lt;@cjs77&gt; (But also note that Grin implements the same strategy)
11:09 AM &lt;Blackwolfsa&gt; Technically it's not a nessasity. You can just sync with the node that provided you with the longest chain
11:09 AM &lt;Blackwolfsa&gt; Pow chain that is
11:09 AM &lt;tk___&gt; if im not a block explorer (or the NSA) what would be the incentive (not financial per se) to run an archival node?
11:10 AM &lt;@cjs77&gt; Or an exchange..
11:10 AM &lt;@cjs77&gt; But none, really :)
11:10 AM &lt;tk___&gt; hmm i see
11:10 AM &lt;@cjs77&gt; Blackwolfsa: good point. There may be a distribution of nodes with different pruning horizons
11:11 AM &lt;@cjs77&gt; I was assuming that most folk run with the default setting :)
11:13 AM &lt;Blackwolfsa&gt; Even then it's not required. We should just ensure our defaults are chosen in such a way to ensure its statistically safe
11:14 AM &lt;Blackwolfsa&gt; For example let's say it's something stupid like 5, you will get the complete header information and then the 5 blocks to satisfy your horizon
11:15 AM &lt;simian_za&gt; what is the proposed default horizon?
11:15 AM &lt;Hansie&gt; Wallets may benefit from services provided by archival nodes as they need some kind of proof that the view of the blockchain they see is real. Some wallets could potentially offer better security than SPV.  This may mean that they want to look at a pruned view of the blockchain going past the pruning horizon.
11:17 AM &lt;Blackwolfsa&gt; But why would a wallet want to look at the history?
11:17 AM &lt;@cjs77&gt; It's 5,000 on Grin, right? But maybe we can have an installer that allows users to select "safe" (10,000), "med" (5,000), "small" (2,500) -- in the absence of an installer the docs for the config file provides this guidance. That way we can be more confident of getting a distribution
11:17 AM &lt;Blackwolfsa&gt; It has even less motivation to due to then a base node
11:18 AM &lt;Hansie&gt; Trust
11:18 AM &lt;Blackwolfsa&gt; Unless I am missing something completely. Wallets only care about its own utxo, not even the other utxo
11:18 AM &lt;Blackwolfsa&gt; What trust? Wallets don't track consensus rules?
11:19 AM &lt;simian_za&gt; The only benefit of seeing the full history is to recover from a reorg, other than a major reorg a non-pruned view of the blockchain has no extra security features?
11:19 AM &lt;neonknight&gt; It seems as if the largest bitcoin reorg was 53 blocks in 2010 and after that only 4.
11:19 AM &lt;simian_za&gt; so 5000 blocks is 3.5 days which seems fairly solid
11:20 AM &lt;simian_za&gt; assuming a 1 minute block time
11:22 AM &lt;@cjs77&gt; Big reorgs are either: a 51% attack, or due to a network partition. Either is really bad if it leads to a reorg of even 100 blocks; but you should be able to get the entire network back in sync no matter how deep the re-org.
11:23 AM &lt;ixside&gt; Is there a ratio of archival nodes to pruned nodes that must be met to recover from a deep re-org?
11:24 AM &lt;@cjs77&gt; Assuming the majority of Monero miners merge-mine Tari the risk of a re-org like that is really miniscule, but you still have to be able to recover from it imho
11:25 AM &lt;@cjs77&gt; ixside: Nope. You only need one honest archival node (Blackwolfsa - check my math ;) )
11:25 AM &lt;Blackwolfsa&gt; I am. Missing why you need one?
11:26 AM &lt;simian_za&gt; yes even one will be enough to recover...as long as you trust it. So more archival nodes = more trust due to lower likelihood of sybil
11:26 AM &lt;simian_za&gt; attack
11:26 AM &lt;Blackwolfsa&gt; The node that has the longest pow chain should also have the required header and most likely blocks as well
11:26 AM &lt;Blackwolfsa&gt; Some base node had to have assembled that longest chain?
11:27 AM &lt;simian_za&gt; but if it is reorged beyond its Horizon how do we recover?
11:27 AM &lt;Hansie&gt; One does not need to trust the archival node, must just be able to verify everything.
11:27 AM &lt;Hansie&gt; Full sync to archival node
11:27 AM &lt;@cjs77&gt; Do you need to trust it? When you reach your pruning horizon, you'll be able to compare UTXO sets again
11:28 AM &lt;Hansie&gt; Yip, do not trust, verify
11:28 AM &lt;Blackwolfsa&gt; Yes if you go beyond your horizon. But remember for some base node that has not happened
11:29 AM &lt;Blackwolfsa&gt; How else do you get a new longest chain?
11:31 AM &lt;Hansie&gt; How is the UTXO set verified?
11:32 AM &lt;Blackwolfsa&gt; He has to have a valid set of utxo + headers
11:32 AM &lt;Blackwolfsa&gt; Otherwise he can't have a longer chain
11:32 AM &lt;@cjs77&gt; doh - you're right. Sorry -- was doing something else and not thinking clearly
11:35 AM &lt;Hansie&gt; So if a reorg goes past the pruning horizon there is a problem, even though highly unlikely?
11:36 AM &lt;Blackwolfsa&gt; No, you sync to the node which has it
11:36 AM &lt;Blackwolfsa&gt; The only case where we might have an issue is if the node supplying the re org has a horizon of 1
11:37 AM &lt;Blackwolfsa&gt; In that case I am in favor of ignoring the reorg. That just smells fishy
11:38 AM &lt;Hansie&gt; Hence cjs77 suggestion of "allows users to select "safe" (10,000), "med" (5,000), "small" (2,500) "
11:38 AM &lt;Blackwolfsa&gt; Yes
11:38 AM &lt;Blackwolfsa&gt; But nothing stop that node from making his 1
11:39 AM &lt;Hansie&gt; So can we assume/fix in the code that if a node is unable to provide the small set that node can never have the longest chain?
11:41 AM &lt;Blackwolfsa&gt; Yes, if he can't prove he has the longest chain, then he doesn't have it
11:42 AM &lt;Hansie&gt; Meaning at least  full blocks for the last 2500 blocks?
11:43 AM &lt;@cjs77&gt; An horizon of 1?
11:44 AM &lt;@cjs77&gt; That's node won't sync anyone though, so why worry?
11:44 AM &lt;Blackwolfsa&gt; It's if he has the longest chain
11:44 AM &lt;@cjs77&gt; The horizon is the # of blocks you track without pruning
11:45 AM &lt;Blackwolfsa&gt; I am thinking in the lines of if some node can't supply you of a valid chain, meaning log enough for your horizon, then you ignore it ans go on
11:45 AM &lt;@cjs77&gt; right? So my node with a horizon of 2,500 blocks will either handle the re-org or be in the same boat as that guy
11:45 AM &lt;Blackwolfsa&gt; So your node has a horizon of 2500. Some block with horizon 1 comes along with the correct headers for a chain of longer pow
11:45 AM &lt;Blackwolfsa&gt; What do you do?
11:46 AM &lt;Blackwolfsa&gt; He can only supply you with one node? This seems to me a vector for attack and he should just be ignored
11:46 AM &lt;@cjs77&gt; You mean supply me with one block?
11:47 AM &lt;ixside&gt; Why would a node have a horizon of 1? 
11:47 AM &lt;Blackwolfsa&gt; That's my point, if he has a horizon that small, he is most likely an attacker
11:48 AM &lt;@cjs77&gt; If the reorg is beyond my pruning horizon, the RFC says I must get blocks from a node with  longer horizon or an archoval node (infinite horizon), so by that logic, yes, I ignore the node with horizon 1
11:48 AM &lt;@cjs77&gt; That makes sense to me, unless I'm missing something
11:49 AM &lt;Blackwolfsa&gt; Yes
11:49 AM &lt;@cjs77&gt; So I'd also ignore a node with a 2,499 block horizon
11:49 AM &lt;Hansie&gt; So logically a reorg cannot be promoted by any node if the full blocks for the impacted portion of the blockchain cannot be provided?
11:49 AM &lt;@cjs77&gt; ^ yes
</code></pre></div></div>

        </div>
      </section>

    </div>
  </div>
</div>
</div>

<!-- Call to action Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <a class="btn btn-lg" href="/blog">Back to blog</a>
                </div>
            </div>
        </div>
    </div>
</section>










    <!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-1">

        <svg class="logo--gem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 70 71.1"><path d="M29.1 0L0 18.9v19.8L28.9 71 70 38.8V18.9L29.1 0zM29.7 8L63 23.4V32L12.7 19 29.7 8zM32.5 31.4l26.8 6.9L32.5 59.3V31.4zM7 24.8l18.5 4.7v27.1L7 36V24.8z"/></svg>

      </div>
      <div class="col-md-5">

        <h1>Built in <strong>Oakland</strong> &amp; <strong>Johannesburg</strong></h1>

        <form id="email_signup" class=" klaviyo_bare_embed_L5CjJF" action="//manage.kmail-lists.com/subscriptions/subscribe" data-ajax-submit="//manage.kmail-lists.com/ajax/subscriptions/subscribe" method="GET" target="_blank" novalidate="novalidate">
  <input type="hidden" name="g" value="L5CjJF">
  <div class="klaviyo_messages">
    <div class="success_message" style="display:none;"></div>
    <div class="error_message" style="display:none;"></div>
  </div>
  <div class="klaviyo_field_group">
    <label for="k_id_email">Newsletter Sign Up</label>
    <input type="email" value="" name="email" id="k_id_email" placeholder="Enter email" />
  </div>
  <div class="klaviyo_form_actions">
    <button type="submit" class="btn btn-lg klaviyo_submit_button">Submit</button>
  </div>
  <p class="privacy-agreement">By clicking ‘Submit’, you agree to our <a href="/privacy_policy" title="Privacy Policy" target="_blank">Privacy Policy</a>.</p>
</form>
<script type="text/javascript" src="//www.klaviyo.com/media/js/public/klaviyo_subscribe.js"></script>
<script type="text/javascript">
  KlaviyoSubscribe.attachToForms('#email_signup', {
    hide_form_on_success: true
  });
</script>

        <p>Copyright &copy; 2018 Tari Labs, LLC. All rights reserved.<br/>
          <a href="/privacy_policy">Privacy Policy</a>&nbsp;
          <a href="/disclaimer">Disclaimer</a>.
        </p>

      </div>
      <div class="col-md-6">
        <div class="footer-menu clearfix">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs">Docs</a></li>
            <li><a href="https://rfc.tari.com/" target="_blank">Tari RFC</a></li>
            <li><a href="https://www.github.com/tari-project" target="_blank">Source code</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/faq">FAQ</a></li>
          </ul>
        </div>
        <div class="footer-socials">
          <ul class="social-icons">
            <li><a href="https://www.twitter.com/tari" target="_blank"><i class="ion-social-twitter"></i></a></li>
            <li><a href="https://www.facebook.com/tarilabs" target="_blank"><i class="ion-social-facebook"></i></a></li>
            <li><a href="https://www.reddit.com/r/tari" target="_blank"><i class="ion-social-reddit"></i></a></li>
            <li><a href="https://www.github.com/tari-project" target="_blank"><i class="ion-social-github"></i></a></li>
            <li><a href="https://t.me/tarilab" target="_blank"><i class="ion-paper-airplane"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>


    </body>
</html>
